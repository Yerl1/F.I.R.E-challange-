services:
  postgres:
    image: postgres:16
    environment:
      POSTGRES_DB: fire_backend
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    ports:
      - "5432:5432"
    volumes:
      - backend-pg-data:/var/lib/postgresql/data

  backend-api:
    build:
      context: ..
      dockerfile: backend/Dockerfile
    environment:
      BACKEND_DATABASE_URL: postgresql+psycopg://postgres:postgres@postgres:5432/fire_backend
      AUTO_BOOTSTRAP: "1"
      BACKEND_DOCS_DIR: /app/docs
      OLLAMA_BASE_URL: http://host.docker.internal:11434
      OLLAMA_MODEL: qwen2.5:7b-instruct-q4_K_M
      MAX_ROWS: 500
      DEFAULT_DAYS_RANGE: 30
      SQL_TIMEOUT_SECONDS: 5
      OLLAMA_TIMEOUT_SECONDS: 30
      GEOCODER_BASE_URL: http://host.docker.internal:8080
      MOCK_LLM: "0"
    depends_on:
      - postgres
    ports:
      - "8001:8001"

volumes:
  backend-pg-data:
